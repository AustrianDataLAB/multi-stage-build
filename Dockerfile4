# This Dockerfile is likely a bit better than the previous
FROM node:19.4-alpine
WORKDIR /opt/blog-search
COPY package.json Gruntfile.js LICENSE README.md Makefile ./
#Install packages
RUN npm install -g grunt-cli \
 && npm install \
 &&  apk add  hugo nginx


# copy webser config and generate static files
WORKDIR /opt/blog-search/blog
COPY blog ./
COPY nginxconfig ./
COPY openssl ./ 
RUN grunt lunr-index && hugo && mkdir -p /var/www/html/public &&\
    cp -r public/  /var/www/html/

EXPOSE 443/tcp
CMD ["/usr/sbin/nginx", "-g", "daemon off;"]
